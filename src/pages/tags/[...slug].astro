---
import Layout from '../../layouts/BaseLayout.astro';
import BaseHead from '../../components/BaseHead.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../../consts';
import { getCollection } from 'astro:content';
import ArticleList from '../../components/ArticleList.astro';
import NavBar from '../../components/NavBar.astro';
import ArticleNavBar from '../../components/ArticleNavBar.astro';
import Footer from '../../components/Footer.astro';

export async function getStaticPaths() {
const posts = await getCollection('blog');
  const tags = [...new Set(posts.map((p) => p.data.tags).flat())];
  return tags.map((t) => ({
   params: { slug: t },
  }));

  }

const params = Astro.params;
const tag = params.slug;

const posts = (await getCollection('blog'))
  .filter((p) => p.data.tags.includes(tag || ''))
  .sort((a, b) => a.data.pubDate.valueOf() - b.data.pubDate.valueOf())
;

---
<Layout title={SITE_TITLE} description={SITE_DESCRIPTION}>
      <h2 class="mb-0 uppercase">
        TAG: {tag} 
      </h2>
      <ArticleList posts={posts} />    
</Layout>
